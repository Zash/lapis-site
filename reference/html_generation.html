<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HTML Generation - Lapis Reference Manual</title>
  <link rel="stylesheet" href="../reference.css?Tue Nov  1 01:09:50 2022" />
  <script type="text/javascript">
  if (window.location.hostname != "localhost") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-136625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
</head>
<body>
  <div class="header">
    <button class="toggle_nav_btn" id="menu_toggle">Menu</button>
    <h1>
      <a href="..">Lapis</a>
    </h1>
    <div id="search_drop" data-root=".." data-index="../reference.json"></div>
    <a href="../changelog.html" class="version_flag">
      v1.10.0
    </a>
  </div>

  <div class="columns">
    <div class="nav_column">
      <div class="scrolling_inner">
        <div class="lang_picker">
          <span class="lang_toggle active" data-lang="moonscript">MoonScript</span>
          <span class="lang_toggle" data-lang="lua">Lua</span>
        </div>

        
          <div class="nav_links">
            <h2>Contents</h2>
            <ul><li><a href="#html-builder-syntax">HTML Builder Syntax</a></li>
<ul><li><a href="#html-builder-syntax/special-attributes">Special attributes</a></li>
<li><a href="#html-builder-syntax/helper-functions">Helper functions</a></li></ul>
<li><a href="#html-in-actions">HTML In Actions</a></li>
<li><a href="#html-widgets">HTML Widgets</a></li>
<ul><li><a href="#html-widgets/rendering-a-widget-from-an-action">Rendering A Widget From An Action</a></li>
<li><a href="#html-widgets/passing-data-to-a-widget">Passing Data To A Widget</a></li>
<li><a href="#html-widgets/rendering-widgets-manually">Rendering Widgets Manually</a></li></ul>
<li><a href="#layouts">Layouts</a></li>
<li><a href="#widget-methods">Widget Methods</a></li>
<ul><li><a href="#widget-methods/include"><code>@@include(other_class)</code></a></li>
<li><a href="#widget-methods/content_for"><code>@content_for(name, [content])</code></a></li>
<li><a href="#widget-methods/has_content_for"><code>@has_content_for(name)</code></a></li></ul>
<li><a href="#html-module">HTML Module</a></li>
<ul><li><a href="#html-module/render_html"><code>render_html(fn)</code></a></li>
<li><a href="#html-module/escape"><code>escape(str)</code></a></li></ul></ul>
          </div>
        

        <div class="nav_links">
          <h2>All Guides</h2>

<ul>
<li><a href="../reference/getting_started.html">Getting Started</a>

<ul>
<li><a href="../reference/moon_getting_started.html">Getting Started With MoonScript</a></li>
<li><a href="../reference/lua_getting_started.html">Getting Started With Lua</a></li>
</ul>
</li>
<li><a href="../reference/actions.html">Requests and Actions</a></li>
<li><a href="../reference/configuration.html">Writing Configurations</a>

<ul>
<li><a href="../reference/lua_creating_configurations.html">Lua configuration syntax</a></li>
<li><a href="../reference/moon_creating_configurations.html">MoonScript configuration syntax</a></li>
</ul>
</li>
<li><a href="../reference/database.html">Database Access, and Queries</a>

<ul>
<li><a href="../reference/models.html">Models</a></li>
</ul>
</li>
<li><a href="../reference/exception_handling.html">Handling Exceptions</a></li>
<li><a href="../reference/input_validation.html">Input Validation</a></li>
<li><a href="../reference/html_generation.html">HTML Generation</a></li>
<li><a href="../reference/etlua_templates.html">etlua Templates</a></li>
<li><a href="../reference/testing.html">Testing</a></li>
<li><a href="../reference/utilities.html">Utility Functions</a></li>
<li><a href="../reference/command_line.html">Command Line Tool</a></li>
<li><a href="../reference/lapis_console.html">Lapis Console</a></li>
</ul>


        </div>

      </div>
    </div>

    <div class="nav_offset">
      <div class="text_column"><div class="override_lang"></div>


<h1>HTML Generation</h1>

<p>This guide is focused on using builder syntax in Lua/MoonScript to generate
HTML. If you're interested in a more traditional templating system see the
<a href="../reference/etlua_templates.html">etlua Templates guide</a>.
This mechanism for generating HTML code is mainly intended to be used with
Moonscript, but it can also be used in Lua code.</p>

<h2><a name="html-builder-syntax" href="#html-builder-syntax">HTML Builder Syntax</a></h2>

<p>HTML templates can be written directly as MoonScript (or Lua) code. This is a
very powerful feature (inspired by <a href="http://erector.rubyforge.org/">Erector</a>)
that gives us the ability to write templates with high composability and also
all the features of MoonScript or Lua. No need to learn any goofy templating
syntax with arbitrary restrictions.</p>

<p>In the context of a HTML renderer, the environment exposes functions that
create HTML tags. The tag builder functions are generated on the fly as you
call them. The output of these functions is written into a buffer that is
compiled in the end and returned as the result</p>

<p>Here are some examples of the HTML generation:</p>

<pre class="highlight lang_moon"><code><span></span><span class="n">div</span><span class="o">!</span>                <span class="c1">-- &lt;div&gt;&lt;/div&gt;</span>
<span class="n">b</span> <span class="s2">&quot;</span><span class="s">Hello World</span><span class="s2">&quot;</span>     <span class="c1">-- &lt;b&gt;Hello World&lt;/b&gt;</span>
<span class="n">div</span> <span class="s2">&quot;</span><span class="s">hi&lt;br/&gt;</span><span class="s2">&quot;</span>       <span class="c1">-- &lt;div&gt;hi&amp;lt;br/&amp;gt;&lt;/div&gt;</span>
<span class="n">text</span> <span class="s2">&quot;</span><span class="s">Hi!</span><span class="s2">&quot;</span>          <span class="c1">-- Hi!</span>
<span class="n">raw</span> <span class="s2">&quot;</span><span class="s">&lt;br/&gt;</span><span class="s2">&quot;</span>         <span class="c1">-- &lt;br/&gt;</span>

<span class="n">element</span> <span class="s2">&quot;</span><span class="s">table</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">width:</span> <span class="s2">&quot;</span><span class="s">100%</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>  <span class="c1">-- &lt;table width=&quot;100%&quot;&gt;&lt;/table&gt;</span>

<span class="n">div</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">footer</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">The Foot</span><span class="s2">&quot;</span>     <span class="c1">-- &lt;div class=&quot;footer&quot;&gt;The Foot&lt;/div&gt;</span>

<span class="n">input</span> <span class="nv">required:</span> <span class="kc">true</span>                <span class="c1">-- &lt;input required/&gt;</span>

<span class="n">div</span> <span class="nf">-&gt;</span>                              <span class="c1">-- &lt;div&gt;Hey&lt;/div&gt;</span>
  <span class="n">text</span> <span class="s2">&quot;</span><span class="s">Hey</span><span class="s2">&quot;</span>

<span class="n">div</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">header</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>             <span class="c1">-- &lt;div class=&quot;header&quot;&gt;&lt;h2&gt;My Site&lt;/h2&gt;</span>
  <span class="n">h2</span> <span class="s2">&quot;</span><span class="s">My Site</span><span class="s2">&quot;</span>                      <span class="c1">--    &lt;p&gt;Welcome!&lt;/p&gt;&lt;/div&gt;</span>
  <span class="n">p</span> <span class="s2">&quot;</span><span class="s">Welcome!</span><span class="s2">&quot;</span></code>
</pre>


<p>The <code>element</code> function is a special builder that takes the name of tag to
generate as the first argument followed by any attributes and content.</p>

<p>The HTML builder methods have lower precedence than any existing variables, so
if you have a variable named <code>div</code> and you want to make a <code>&lt;div&gt;</code> tag you'll
need to call <code>element "div"</code>.</p>

<blockquote><p>If you want to create a <code>&lt;table&gt;</code> or <code>&lt;select&gt;</code> tag you'll need to use
<code>element</code> because Lua uses those names in the built-in modules.</p></blockquote>

<p>All strings passed to the HTML builder functions (attribute names, values, or
tag contents) are escaped automatically. You never have to worry about
introducing any cross site scripting vulnerabilities.</p>

<h3><a name="html-builder-syntax/special-attributes" href="#html-builder-syntax/special-attributes">Special attributes</a></h3>

<p>The <code>class</code> attribute can be passed as a table, and the class list will be
constructed from it. The table can contain either array element, or hash
elements:</p>

<pre class="highlight lang_moon"><code><span></span><span class="n">div</span> <span class="kt">{</span>
  <span class="nv">class:</span> <span class="kt">{</span><span class="s2">&quot;</span><span class="s">one</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">two</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">three:</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">four:</span> <span class="kc">true</span><span class="kt">}</span>
<span class="kt">}</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">Hello world!</span><span class="s2">&quot;</span></code>
</pre>


<p>Will generate:</p>

<pre class="highlight lang_html"><code><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;one two four&quot;</span><span class="p">&gt;</span>Hello world!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code>
</pre>


<h3><a name="html-builder-syntax/helper-functions" href="#html-builder-syntax/helper-functions">Helper functions</a></h3>

<p>In addition to the tag functions, a few other helper functions are also available:</p>

<ul>
<li><code>raw(str)</code> &mdash; outputs the argument, a string, directly to the buffer without escaping.</li>
<li><code>capture(func)</code> &mdash; executes the function argument in the context of the HTML builder environment, returns the compiled result as a string instead of writing to buffer.</li>
<li><code>text(args)</code> &mdash; outputs the argument to the buffer, escaping it if it&rsquo;s a string. If it&rsquo;s a function, it executes the function in HTML builder environment. If it&rsquo;s a table, it writes each item in the table</li>
<li><code>widget(SomeWidget)</code> &mdash; renders another widget in the current output buffer. Automatically passes the enclosing context</li>
<li><code>render(template_name)</code> &mdash; renders another widget or view by the module name. Lets you render etlua templates from inside builder</li>
</ul>


<h2><a name="html-in-actions" href="#html-in-actions">HTML In Actions</a></h2>

<p>If we want to generate HTML directly in our action we can use the <code>@html</code>
method:</p>

<pre class="highlight lang_moon"><code><span></span><span class="s2">&quot;</span><span class="s">/</span><span class="s2">&quot;</span><span class="o">:</span> <span class="nf">=&gt;</span>
  <span class="vc">@html</span> <span class="nf">-&gt;</span>
    <span class="n">h1</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">header</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">Hello</span><span class="s2">&quot;</span>
    <span class="n">div</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">body</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="n">text</span> <span class="s2">&quot;</span><span class="s">Welcome to my site!</span><span class="s2">&quot;</span></code>
</pre>


<p>The environment of the function passed to <code>@html</code> is set to one that support
the HTML builder functions described above. The return value of the <code>@html</code>
method is the generated HTML as a string. Returning this from the action allows
us to render send it right to the browser</p>

<h2><a name="html-widgets" href="#html-widgets">HTML Widgets</a></h2>

<p>The preferred way to write HTML is through widgets. Widgets are classes who are
only concerned with outputting HTML. They use the same syntax as the <code>@html</code>
helper shown above for writing HTML.</p>

<p>When Lapis loads a widget automatically it does it by package name. For
example, if it was loading the widget for the name <code>"index"</code> it would try to
load the module <code>views.index</code>, and the result of that module should be the
widget.</p>

<p>This is what a widget looks like:</p>

<pre class="highlight lang_moon"><code><span></span><span class="c1">-- views/index.moon</span>
<span class="k">import</span> <span class="nc">Widget</span> <span class="k">from</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">lapis.html</span><span class="s2">&quot;</span>

<span class="k">class</span> <span class="nc">Index</span> <span class="k">extends</span> <span class="nc">Widget</span>
  <span class="nv">content:</span> <span class="nf">=&gt;</span>
    <span class="n">h1</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">header</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">Hello</span><span class="s2">&quot;</span>
    <span class="n">div</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">body</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="n">text</span> <span class="s2">&quot;</span><span class="s">Welcome to my site!</span><span class="s2">&quot;</span></code>
</pre>


<blockquote><p>The name of the widget class is insignificant, but it&rsquo;s worth making one
because some systems can auto-generate encapsulating HTML named after the
class.</p></blockquote>

<h3><a name="html-widgets/rendering-a-widget-from-an-action" href="#html-widgets/rendering-a-widget-from-an-action">Rendering A Widget From An Action</a></h3>

<p>The <code>render</code> option key is used to render a widget. For example you can render
the <code>"index"</code> widget from our action by returning a table with render set to
the name of the widget:</p>

<pre class="highlight lang_moon"><code><span></span><span class="s2">&quot;</span><span class="s">/</span><span class="s2">&quot;</span><span class="o">:</span> <span class="nf">=&gt;</span>
  <span class="nv">render:</span> <span class="s2">&quot;</span><span class="s">index</span><span class="s2">&quot;</span></code>
</pre>


<p>If the action has a name, then we can set render to <code>true</code> to load the widget
with the same name as the action:</p>

<pre class="highlight lang_moon"><code><span></span><span class="kt">[</span><span class="nv">index:</span> <span class="s2">&quot;</span><span class="s">/</span><span class="s2">&quot;</span><span class="kt">]</span><span class="o">:</span> <span class="nf">=&gt;</span>
  <span class="nv">render:</span> <span class="kc">true</span></code>
</pre>


<p>By default <code>views.</code> is prepended to the widget name and then loaded
using Lua&rsquo;s <code>require</code> function. The <code>views</code> prefix can be customized by
overwriting the <code>views_prefix</code> member of your application subclass:</p>

<pre class="highlight lang_moon"><code><span></span><span class="k">class</span> <span class="nc">Application</span> <span class="k">extends</span> <span class="n">lapis</span><span class="o">.</span><span class="n">Application</span>
  <span class="nv">views_prefix:</span> <span class="s2">&quot;</span><span class="s">app_views</span><span class="s2">&quot;</span>

  <span class="c1">-- will use &quot;app_views.home&quot; as the view</span>
  <span class="kt">[</span><span class="nv">home:</span> <span class="s2">&quot;</span><span class="s">/home</span><span class="s2">&quot;</span><span class="kt">]</span><span class="o">:</span> <span class="nf">=&gt;</span> <span class="nv">render:</span> <span class="kc">true</span></code>
</pre>


<h3><a name="html-widgets/passing-data-to-a-widget" href="#html-widgets/passing-data-to-a-widget">Passing Data To A Widget</a></h3>

<p>Any <code>@</code> variables set in the action can be accessed in the widget. Additionally
any of the helper functions like <code>@url_for</code> are also accessible.</p>

<pre class="highlight lang_moon"><code><span></span><span class="c1">-- app.moon</span>
<span class="k">class</span> <span class="nc">App</span> <span class="k">extends</span> <span class="n">lapis</span><span class="o">.</span><span class="n">Application</span>
  <span class="kt">[</span><span class="nv">index:</span> <span class="s2">&quot;</span><span class="s">/</span><span class="s2">&quot;</span><span class="kt">]</span><span class="o">:</span> <span class="nf">=&gt;</span>
    <span class="vc">@page_title</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Welcome To My Page</span><span class="s2">&quot;</span>
    <span class="nv">render:</span> <span class="kc">true</span></code>
</pre>


<pre class="highlight lang_moon"><code><span></span><span class="c1">-- views/index.moon</span>
<span class="k">import</span> <span class="nc">Widget</span> <span class="k">from</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">lapis.html</span><span class="s2">&quot;</span>

<span class="k">class</span> <span class="nc">Index</span> <span class="k">extends</span> <span class="nc">Widget</span>
  <span class="nv">content:</span> <span class="nf">=&gt;</span>
    <span class="n">h1</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">header</span><span class="s2">&quot;</span><span class="p">,</span> <span class="vc">@page_title</span>
    <span class="n">div</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">body</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="n">text</span> <span class="s2">&quot;</span><span class="s">Welcome to my site!</span><span class="s2">&quot;</span></code>
</pre>


<h3><a name="html-widgets/rendering-widgets-manually" href="#html-widgets/rendering-widgets-manually">Rendering Widgets Manually</a></h3>

<p>Widgets can also be rendered manually by instantiating them and calling the
<code>render_to_string</code> method.</p>

<pre class="highlight lang_moon"><code><span></span><span class="nc">Index</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">views.index</span><span class="s2">&quot;</span>

<span class="n">widget</span> <span class="o">=</span> <span class="nc">Index</span> <span class="nv">page_title:</span> <span class="s2">&quot;</span><span class="s">Hello World</span><span class="s2">&quot;</span>
<span class="nb">print</span> <span class="n">widget</span><span class="o">\</span><span class="n">render_to_string</span><span class="o">!</span></code>
</pre>


<p>If you want to use helpers like <code>@url_for</code> you also need to include them in the
widget instance. Any object can be included as a helper, and its methods will
be made available inside of the widget.</p>

<pre class="highlight lang_moon"><code><span></span><span class="n">html</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">lapis.html</span><span class="s2">&quot;</span>
<span class="k">class</span> <span class="nc">SomeWidget</span> <span class="k">extends</span> <span class="n">html</span><span class="o">.</span><span class="n">Widget</span>
  <span class="nv">content:</span> <span class="nf">=&gt;</span>
    <span class="n">a</span> <span class="nv">href:</span> <span class="vc">@url_for</span><span class="kt">(</span><span class="s2">&quot;</span><span class="s">test</span><span class="s2">&quot;</span><span class="kt">)</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">Test Page</span><span class="s2">&quot;</span>

<span class="k">class</span> <span class="k">extends</span> <span class="n">lapis</span><span class="o">.</span><span class="n">Application</span>
  <span class="kt">[</span><span class="nv">test:</span> <span class="s2">&quot;</span><span class="s">/test_render</span><span class="s2">&quot;</span><span class="kt">]</span><span class="o">:</span> <span class="nf">=&gt;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="nc">SomeWidget</span><span class="o">!</span>
    <span class="n">widget</span><span class="o">\</span><span class="n">include_helper</span> <span class="vc">@</span>
    <span class="n">widget</span><span class="o">\</span><span class="n">render_to_string</span><span class="o">!</span></code>
</pre>


<p>You should avoid rendering widgets manually when possible. When in an action
use the <code>render</code> <a href="#request-object-request-options">request option</a>. When in
another widget use the <code>widget</code> helper function. Both of these methods will
ensure the same output buffer is shared to avoid unnecessary string
concatenations.</p>

<h2><a name="layouts" href="#layouts">Layouts</a></h2>

<p>Whenever an action is rendered normally the result is inserted into the
current layout. The layout is just another widget, but it is used across many
pages. Typically this is where you would put your <code>&lt;html&gt;</code> and <code>&lt;head&gt;</code> tags.</p>

<p>Lapis comes with a default layout that looks like this:</p>

<pre class="highlight lang_moon"><code><span></span><span class="n">html</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">lapis.html</span><span class="s2">&quot;</span>

<span class="k">class</span> <span class="nc">DefaultLayout</span> <span class="k">extends</span> <span class="n">html</span><span class="o">.</span><span class="n">Widget</span>
  <span class="nv">content:</span> <span class="nf">=&gt;</span>
    <span class="n">html_5</span> <span class="nf">-&gt;</span>
      <span class="n">head</span> <span class="nf">-&gt;</span> <span class="n">title</span> <span class="vc">@title</span> <span class="k">or</span> <span class="s2">&quot;</span><span class="s">Lapis Page</span><span class="s2">&quot;</span>
      <span class="n">body</span> <span class="nf">-&gt;</span> <span class="vc">@content_for</span> <span class="s2">&quot;</span><span class="s">inner</span><span class="s2">&quot;</span></code>
</pre>


<p>Use this as a starting point for creating your own layout. The content of your
page will be injected in the location of the call to <code>@content_for "inner"</code>.</p>

<p>We can specify the layout for an entire application or specify it for a
specific action. For example, if we have our new layout in <code>views/my_layout.moon</code></p>

<pre class="highlight lang_moon"><code><span></span><span class="k">class</span> <span class="k">extends</span> <span class="n">lapis</span><span class="o">.</span><span class="n">Application</span>
  <span class="nv">layout:</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">views.my_layout</span><span class="s2">&quot;</span></code>
</pre>


<p>If we want to set the layout for a specific action we can provide it as part of
the action&rsquo;s return value.</p>

<pre class="highlight lang_moon"><code><span></span><span class="k">class</span> <span class="k">extends</span> <span class="n">lapis</span><span class="o">.</span><span class="n">Application</span>
  <span class="c1">-- the following two have the same effect</span>
  <span class="s2">&quot;</span><span class="s">/home1</span><span class="s2">&quot;</span><span class="o">:</span> <span class="nf">=&gt;</span>
    <span class="nv">layout:</span> <span class="s2">&quot;</span><span class="s">my_layout</span><span class="s2">&quot;</span>

  <span class="s2">&quot;</span><span class="s">/home2</span><span class="s2">&quot;</span><span class="o">:</span> <span class="nf">=&gt;</span>
    <span class="nv">layout:</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">views.my_layout</span><span class="s2">&quot;</span>

  <span class="c1">-- this doesn&#39;t use a layout at all</span>
  <span class="s2">&quot;</span><span class="s">/no_layout</span><span class="s2">&quot;</span><span class="o">:</span> <span class="nf">=&gt;</span>
    <span class="nv">layout:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">No layout rendered!</span><span class="s2">&quot;</span></code>
</pre>


<p>As demonstrated in the example, passing false will prevent any layout from
being rendered.</p>

<h2><a name="widget-methods" href="#widget-methods">Widget Methods</a></h2>

<h3><a name="widget-methods/include" href="#widget-methods/include"><code>@@include(other_class)</code></a></h3>

<p>Class method that copies the methods from another class into this widget.
Useful for mixin in shared functionality across multiple widgets.</p>

<pre class="highlight lang_moon"><code><span></span><span class="k">class</span> <span class="nc">MyHelpers</span>
  <span class="nv">item_list:</span> <span class="kt">(</span><span class="n">items</span><span class="kt">)</span> <span class="nf">=&gt;</span>
    <span class="n">ul</span> <span class="nf">-&gt;</span>
      <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">items</span>
        <span class="n">li</span> <span class="n">item</span>


<span class="k">class</span> <span class="nc">SomeWidget</span> <span class="k">extends</span> <span class="n">html</span><span class="o">.</span><span class="n">Widget</span>
  <span class="vc">@include</span> <span class="nc">MyHelpers</span>

  <span class="nv">content:</span> <span class="nf">=&gt;</span>
    <span class="vc">@item_list</span> <span class="kt">{</span><span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span><span class="kt">}</span></code>
</pre>


<h3><a name="widget-methods/content_for" href="#widget-methods/content_for"><code>@content_for(name, [content])</code></a></h3>

<p><code>content_for</code> is used for sending HTML or strings from the view to the layout.
You've probably already seen <code>@content_for "inner"</code> if you've looked at
layouts. By default the content of the view is placed in the content block
called <code>"inner"</code>.</p>

<p>You can create arbitrary content blocks from the view by calling <code>@content_for</code>
with a name and some content:</p>

<pre class="highlight lang_moon"><code><span></span><span class="k">class</span> <span class="nc">MyView</span> <span class="k">extends</span> <span class="nc">Widget</span>
  <span class="nv">content:</span> <span class="nf">=&gt;</span>
    <span class="vc">@content_for</span> <span class="s2">&quot;</span><span class="s">title</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">This is the title of my page!</span><span class="s2">&quot;</span>

    <span class="vc">@content_for</span> <span class="s2">&quot;</span><span class="s">footer</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="n">div</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">custom_footer</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">The Footer</span><span class="s2">&quot;</span></code>
</pre>


<p>You can use either strings or builder functions as the content.</p>

<p>To access the content from the layout, call <code>@content_for</code> without the content
argument:</p>

<pre class="highlight lang_moon"><code><span></span><span class="k">class</span> <span class="nc">MyLayout</span> <span class="k">extends</span> <span class="nc">Widget</span>
  <span class="nv">content:</span> <span class="nf">=&gt;</span>
    <span class="n">html</span> <span class="nf">-&gt;</span>
      <span class="n">body</span> <span class="nf">-&gt;</span>
        <span class="n">div</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">title</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
          <span class="vc">@content_for</span> <span class="s2">&quot;</span><span class="s">title</span><span class="s2">&quot;</span>

        <span class="vc">@content_for</span> <span class="s2">&quot;</span><span class="s">inner</span><span class="s2">&quot;</span>
        <span class="vc">@content_for</span> <span class="s2">&quot;</span><span class="s">footer</span><span class="s2">&quot;</span></code>
</pre>


<p>If a string is used as the value of a content block then it will be escaped
before written to the buffer. If you want to insert a raw string then you can
use a builder function in conjunction with the <code>raw</code> function:</p>

<pre class="highlight lang_moon"><code><span></span><span class="vc">@content_for</span> <span class="s2">&quot;</span><span class="s">footer</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="n">raw</span> <span class="s2">&quot;</span><span class="s">&lt;pre&gt;this wont&#39; be escaped&lt;/pre&gt;</span><span class="s2">&quot;</span></code>
</pre>


<h3><a name="widget-methods/has_content_for" href="#widget-methods/has_content_for"><code>@has_content_for(name)</code></a></h3>

<p>Checks to see if content for <code>name</code> is set.</p>

<pre class="highlight lang_moon"><code><span></span><span class="k">class</span> <span class="nc">MyView</span> <span class="k">extends</span> <span class="nc">Widget</span>
  <span class="nv">content:</span> <span class="nf">=&gt;</span>
    <span class="k">if</span> <span class="vc">@has_content_for</span> <span class="s2">&quot;</span><span class="s">things</span><span class="s2">&quot;</span>
      <span class="vc">@content_for</span> <span class="s2">&quot;</span><span class="s">things</span><span class="s2">&quot;</span>
    <span class="k">else</span>
      <span class="n">div</span> <span class="nf">-&gt;</span>
        <span class="n">text</span> <span class="s2">&quot;</span><span class="s">default content</span><span class="s2">&quot;</span></code>
</pre>


<h2><a name="html-module" href="#html-module">HTML Module</a></h2>

<pre class="highlight lang_moon"><code><span></span><span class="n">html</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">lapis.html</span><span class="s2">&quot;</span></code>
</pre>


<h3><a name="html-module/render_html" href="#html-module/render_html"><code>render_html(fn)</code></a></h3>

<p>Runs the function, <code>fn</code> in the HTML rendering context as described above.
Returns the resulting HTML. The HTML context will automatically convert any
reference to an undefined global variable into a function that will render the
appropriate tag.</p>

<pre class="highlight lang_moon"><code><span></span><span class="k">import</span> <span class="n">render_html</span> <span class="k">from</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">lapis.html</span><span class="s2">&quot;</span>

<span class="nb">print</span> <span class="n">render_html</span> <span class="nf">-&gt;</span>
  <span class="n">div</span> <span class="nv">class:</span> <span class="s2">&quot;</span><span class="s">item</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="n">strong</span> <span class="s2">&quot;</span><span class="s">Hello!</span><span class="s2">&quot;</span></code>
</pre>


<h3><a name="html-module/escape" href="#html-module/escape"><code>escape(str)</code></a></h3>

<p>Escapes any HTML special characters in the string. The following are escaped:</p>

<ul>
<li><code>&amp;</code> &mdash; <code>&amp;amp;</code></li>
<li><code>&lt;</code> &mdash; <code>&amp;lt;</code></li>
<li><code>&gt;</code> &mdash; <code>&amp;gt;</code></li>
<li><code>"</code> &mdash; <code>&amp;quot;</code></li>
<li><code>'</code> &mdash; <code>&amp;#039;</code></li>
</ul>


      </div>
    </div>

  </div>

  <script src="../lib/jquery.min.js"></script>
  <script src="../lib/react.production.min.js"></script>
  <script src="../lib/react-dom.production.min.js"></script>
  <script src="../lib/react-dom-factories.js"></script>
  <script src="../lib/lunr.min.js"></script>
  <script type="text/javascript" src="../search.js?Tue Nov  1 01:09:50 2022"></script>
  <script type="text/javascript" src="../reference.js?Tue Nov  1 01:09:50 2022"></script>
  <script type="text/javascript">
    new L.Reference();
  </script>
</body>
</html>
