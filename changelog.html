title: Changelog
--

<div class="box only_box changelog">
  <h3>Changelog <span class="decor">‚ùß</span></h3>
$markdown{[[
v1.0.3 -- **July 23 2014**

  * Default application structure updated, `lapis.serve` is now executed from Nginx configuration. Default application code is now a regular Lua module that can be required with no side effects
  * `ngx_postgres` is deprecated, docs removed. [pgmoon documentation added]($root/reference/database.html). (ngx_postgres support will be removed in 1.1.0)
  * Spec server waits to shut down before starting new one when runnning non-attached (fixes timeout when executing many test files in a row)
  * Spec server can be run on fresh checkout without running `lapis build` first
  * Added [new documentation for request lifecycle]($root/reference/actions.html)
  * Added [`cookie_attributes` extension function]($root/reference/actions.html#request-object-cookies) for configuring new cookies
  * Fix leaking objects passed to `lapis.serve` (only applies when sending many different applications)

v1.0.2 -- **July 15 2014**

  * Add new [reference guide for etlua]($root/reference/etlua_templates.html)
  * Enforce routes to be searched in order they are defined for Lua style applications
  * Fix bug where `render`/`widget` functions in etlua template scope were shadowed
  * Add `Model\columns` method to get list of column names and types for a table
  * `LAPIS_SHOW_QUERIES` environment variable can be used to enable printing `pgmoon` queries during specs
  * Misc documentation updates, more specs

v1.0.1 -- **Jun 30 2014**

  * `LAPIS_OPENRESTY` environment variable can be used to set OpenResty binary location
  * Fixed a bug with `lapis.serve` that prevented a string argument from loading correctly
  * Deprecate old PostgreSQL configuration syntax, document [new table based syntax]($root/reference/database.html#establishing-a-connection)

v1.0.0 -- **Jun 16 2014**

#### General

  * Add a new Lua friendly API, see [Getting Started With Lua]($root/reference/lua_getting_started.html)
  * Add support for [etlua](http://github.com/leafo/etlua) as a view language, see Lua guide
  * Overhaul to [reference manual](reference.html): better organization, Lua examples, and more guides

#### Database

  * `Model\include_in` can take a `where` option to filter results
  * A flipped `Model\include_in` no longer throws error when not using primary key
  * `model\find_all` can take a `where` option to filter results
  * `model\find_all` can take a `db.raw` value as search key
  * `updated_at` and `created_at` aren't overwritten when creating a model if manually set
  * `db.escape_identifier` is aware of `db.raw` values, won't try to escape them
  * `create_index` can take a index method and a tablespace in options table *(dant4z)*
  * All constraints are checked on `Model\create` instead of just those for values provided
  * Errors thrown from failed queries have query in them now
  * Fix bug where `db.raw` values would not work in `create_index`, prevening you from creating indexes on expressions
  * Postgres connection options can be set as table instead of connect string
  * Add support for [pgmoon](http://github.com/leafo/pgmoon), documentation forthcoming

#### Util

  * `util.time_ago_in_words` can handle dates in the future
  * `util.parse_query_string` will correctly parse empty string values
  * `assert_error` passes through all arguments passed to it instead of just first argument
  * `cached` can have a dynamically set dictionary by setting `dict` to a function

#### Misc

  * A class passed to `widget` within MoonScript template will automatically be instantiated
  * Update OpenResty search path to find instalation from Brew on OSX *(Stefan Natchev)*
  * Add new `logging` config directive for fine grained control over individual logging
  * Updated homepage, <http://leafo.net/lapis>

v0.0.10 -- **Jan 18th, 2014**

  * Correctly detect installation of OpenResty 1.5.x
  * Bug fix and documentation for [`@content_for`](reference.html#html-generation-widget-methods)
  * Add `@has_content_for`

v0.0.9 -- **Jan 9th, 2014**

  * Backwards incompatible change to [`cached` API](reference.html#utilities-caching)
  * Cached can take expiration time, override cache key, and a function to
  determine when to cache
  * Fixed bug where `NULL` check used `=` instead of `is NULL` in generated SQL
  * `include_in`, take take fields to select as an option
  * Fixed bug where cache didn't preserve status code
  * `db.is_raw(val)` for detecting if value is created from `db.raw`
  * `db.format_date(d)` for formatting time to SQL syntax
  * More tests

v0.0.8 -- **December 7th, 2013**

  * **CRITICAL:** Fixed an issue where a invalid multipart upload could cause worker to loop infinitely
  * Added new [`json_params`](reference.html#utilities-application-helpers) function to parse JSON from request body into `@params`
  * `@content_for` can now be used to set content from view widgets to be seen by layout
  * `respond_to` now provides a [default HEAD action](reference.html#utilities-application-helpers)
  * Added `lapis signal` command line command to send arbitrary signal to Nginx process
  * Added [`find_action`](reference.html#lapis-applications-class-methods) method to applications
  * Attributes now have spaces around them when using HTML builder
  * Test coverage improved

v0.0.7 -- **November 5th, 2013**

  * Added [`prepare_results`](reference.html#models-pagination) option to paginated
  * Paginator options are passed to select, enabling you to set fields
  * Fixed an issue where doing an async operation (eg. querying) inside of a
    widget render would cause it to lose it's environment and crash when handling
    concurrent requests
  * Optimized HTML renderer to avoid creating excess tables
  * Added application cache to `lapis.server`, will cache an instance of the class and reuse it
  * `@include` class method on widgets and applications can take a string and will load it using `require`
  * Added [`@include` class method on widgets](reference.html#html-generation-widget-methods) for mixing in other classes
  * `"lapis.spec.server"`'s `request` function can be passed headers, will extract host header if passed a full URL
  * Enhanced test coverage

v0.0.6 -- **October 17th, 2013**

  * Added `"lapis.spec.server"` module for spawning a [test server](reference.html#testing-using-the-test-server)
  * `env LAPIS_ENVIRONMENT=envname` is now injected on top of config to ensure
    correct environment is passed down when changing environments of a running
    server. Default config has been updated to no longer have `env
    LAPIS_ENVIRONMENT`, it's recommended but not required to remove that line
    from your config.
  * When an application extends from another it will now search up the
    inheritance tree and take routes from parents
  * `mock_request` can take a previous requests headers, see [mocking a request](reference.html#testing-mocking-a-request)
  * You can now set nil to @session key to delete it
  * Rewrote how the command line tools provision a server to execute code one,
    can now run queries directly in the console.
  * Fix trying to save write session when it hasn't been loaded
  * Fix issue where multiple cookies could not be set in a single request
  * Fix issue where adding a third value to a single header would not show up

v0.0.5 -- **September 1st, 2013**

  * Added request mocking for [writing tests](reference.html#testing)
  * Added [`lapis.cache`](reference.html#utilities-caching) module
  * Added `autoload` [utility method](reference.html#utilities-methods)
  * Added [documentation for file uploads](reference.html#utilities-file-uploads)
  * `widget` method inside of HTML renderer will inject current helpers and set `@parent`
  * Default config has `code_cache` as a variable now
  * Enhanced test coverage

v0.0.4 -- **August 13th, 2013**

  * [`lapis migrate`](reference.html#command-line-interface-lapis-migrate) command will start a temporary server if it can't find a running one
  * Add [`lapis term`](reference.html#command-line-interface-lapis-term) command to stop a backgrounded server
  * HTML void tags no longer render a closing tag
  * Add [paginator](reference.html#models-pagination) for paging through queries with many results
  * Add `Model\count` for counting items in a query
  * `Model\update` and `Model\delete` will convert primary key `nil` values to `db.NULL`
  * Small enhancements to command line tool

v0.0.3 -- **July 22th, 2013**

  * Added ability to execute Lua from command line on server
  * [Documentation for command line interface](reference.html#command-line-interface)
  * `lapis build` command for [building config and sending HUP](reference.html#command-line-interface-lapis-build)
  * `lapis migrate` command for [running migrations on command line](reference.html#command-line-interface-lapis-migrate)
  * `lapis new` can take optional `--git` and `--tup` flags
  * Commands use `lapis_environment` module to get default environment

v0.0.2 -- **June 17th, 2013**

  * Session secret and name are now [stored in the config](reference.html#request-object-session)
  * `json` and `redirect_to` can also set `status`
  * Fix issue with precedence of HTML builder helpers
  * [Lua mode](reference.html#lapis-in-lua)
  * updated `trim_filter` helper, [reference](reference.html#utilities-methods)
  * Misc bug fixes
  * Add a lot more documentation, fix typos
  * Add test suite

v0.0.1 -- **April 24th, 2013**

 * Initial release
]]}
</div>

